tinymce.PluginManager.add('imageupload', function(editor, url) {
	var myRegex = /.+?(?=index.php)/;
	var myUrl = myRegex.exec(window.location.href);

	editor.addButton('imageupload', {
		tooltip: 'Upload an image',
		icon : 'image',
		text: 'Upload',
		onclick: function() {
			editor.windowManager.open({
			title: 'Upload an image',

			//change this route to the one that returns the '_image-dialog.blade.php' file as a view
			file : myUrl[0] + 'index.php/imageupload',
			width : 520,
			height: 400,
			buttons: [
			{
				text: 'Close',
				onclick: 'close'
			}]
			});
		}
	});
});
